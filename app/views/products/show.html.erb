<script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_API'] %>&callback=initMap"
async defer></script>

<script type="text/javascript">
var map;
function initMap() {
  map = new google.maps.Map(document.getElementById('multi-markers'), {
    <% if prod = @product %>
      center: {lat: <%= prod.user.latitude %>, lng: <%= prod.user.longitude %>},
    <% else %>
      center: {lat: 45.5231, lng: -122.6765},
    <% end %>
    zoom: 11,
    styles: [{"featureType":"all","elementType":"geometry.fill","stylers":[{"color":"#ffffff"},{"visibility":"simplified"}]},{"featureType":"administrative","elementType":"labels.text.fill","stylers":[{"color":"#444444"}]},{"featureType":"landscape","elementType":"all","stylers":[{"color":"#f2f2f2"}]},{"featureType":"poi","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"road","elementType":"all","stylers":[{"saturation":-100},{"lightness":45}]},{"featureType":"road.highway","elementType":"all","stylers":[{"visibility":"simplified"}]},{"featureType":"road.arterial","elementType":"labels.icon","stylers":[{"visibility":"off"}]},{"featureType":"transit","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"water","elementType":"all","stylers":[{"color":"#ff862f"},{"visibility":"on"}]}]
  });
    var contentString<%=prod.id%> = '<div id="content">'+
        '<div id="siteNotice">'+
        '$<%= prod.price %> Dollars</div><% unless current_user == @user %>' +
          '<%= link_to "Send message", new_message_path(to: prod.user.id), :class =>' + '"btn' + 'btn-default btn-sm" %>' + '<% end %><h1 id="firstHeading" class="firstHeading"><%= prod.name %></h1>' +
        '<div id="bodyContent"><p><%= prod.name %> User Information:</p><p>Email: <%=prod.user.email%></p> <p>Go to: <%=link_to prod.user.user_name, user_path(prod.user) %></p>'+
        '</div>'+
        '</div>';

    var infowindow<%=prod.id%> = new google.maps.InfoWindow({
      content: contentString<%=prod.id%>
    });
    var marker<%=prod.id%> = new google.maps.Marker({
      position: {lat: <%=prod.user.latitude%>, lng: <%=prod.user.longitude%>},
      map: map,
      title: 'Hello World!'
    });
    marker<%=prod.id%>.addListener('click', function() {
      infowindow<%=prod.id%>.open(map, marker<%=prod.id%>);
    });
}
</script>


<div class="row">
  <div class="col-md-6">

    <% content_for(:navbar) do %>
      <% unless @product.id == @product.category.products.first.id %>
        <%= link_to 'Previous Product in ' + @product.category.name, @product.previous, :class => "btn btn-primary" %>
      <% end %>
      <% unless @product.id == @product.category.products.last.id %>
        <%= link_to 'Next Product in ' + @product.category.name, @product.next, :class => "btn btn-primary" %>
      <% end %>
    <% end %>
    <h1><%= @product.name.titleize %> Page</h1>
    <br>
    <%= image_tag(@product.image.url(:medium)) %>
  </div>
  <div class="col-md-6">
    <%= link_to "Message " + @product.user.user_name, new_message_path(to: @product.user.id), :class => "btn btn-success" %>
    <div id="multi-markers" style='width: 600px; height: 400px;'></div>
  </div>
</div>

<br><br>

<% if @current_user %>
  <% if @product.user == @current_user || @current_user.user_name == "Admin" %>
    <div class="btn-group">
      <%= link_to "Edit Product", edit_product_path(@product), :class => "btn btn-primary" %>
      <%= link_to "Delete", product_path(@product), :class => "btn btn-primary", :data => {:confirm => "You Sure?", :method => 'delete'} %>
    </div>
  <% end %>
<% end %>


<hr>

<%= link_to "Back to category", category_path(@category) %>
